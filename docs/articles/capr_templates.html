<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capr for Templating Cohort Definitions • Capr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Capr for Templating Cohort Definitions">
<meta property="og:description" content="Capr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Capr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Capr-conceptSets.html">Working with Concept Sets in Capr</a>
    </li>
    <li>
      <a href="../articles/capr_design.html">Capr Design Guide and Roadmap</a>
    </li>
    <li>
      <a href="../articles/capr_templates.html">Capr for Templating Cohort Definitions</a>
    </li>
    <li>
      <a href="../articles/Examples.html">Cohort Definition Examples</a>
    </li>
    <li>
      <a href="../articles/Using-Capr.html">Using Capr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/Capr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Capr for Templating Cohort Definitions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/Capr/blob/HEAD/vignettes/capr_templates.Rmd" class="external-link"><code>vignettes/capr_templates.Rmd</code></a></small>
      <div class="hidden name"><code>capr_templates.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/Capr" class="external-link">Capr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="building-a-template">Building a Template<a class="anchor" aria-label="anchor" href="#building-a-template"></a>
</h2>
<p>Capr is at its most valuable when it is used as a tool for templating
cohort definitions. In a study we may need multiple cohort definitions
that use the same logic but vary by concept sets. For example, in a
study we need to create cohort covariates for various conditions. The
cohort logic is simple, as condition occurrence with at least 365 days
of prior observation. The concept sets used could be various
cardiovascular events like stroke, hypertension, acute myocardial
infarction, heart failure, and atrial fibrillation.</p>
<p>To build all these cohorts using a template, we can easily define the
logic in Capr. Capr templates are functions were the input is a concept
set that differs in the logic.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvEvents</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">conceptSet</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    entry <span class="op">=</span> <span class="fu"><a href="../reference/entry.html">entry</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/condition.html">condition</a></span><span class="op">(</span><span class="va">conceptSet</span><span class="op">)</span>,</span>
<span>      observationWindow <span class="op">=</span> <span class="fu"><a href="../reference/continuousObservation.html">continuousObservation</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    exit <span class="op">=</span> <span class="fu"><a href="../reference/exit.html">exit</a></span><span class="op">(</span></span>
<span>      endStrategy <span class="op">=</span> <span class="fu"><a href="../reference/observationExit.html">observationExit</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The cohort template above describes the logic we desire. An entry
event based on a condition occurrence with 365 days of prior observation
and the cohort exit is based on the last available date of
observation.</p>
<p>Once we have a Capr template, our next step is to add concept sets
into the template functions. Using <a href="https://athena.ohdsi.org/" class="external-link">Athena</a>, I look up the OMOP concept
ids for the concepts of interest. With these concept ids, I can create a
concept set for each cardiovascular event</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">afib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cs.html">cs</a></span><span class="op">(</span><span class="fu"><a href="../reference/cs.html">descendants</a></span><span class="op">(</span><span class="fl">313217</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Atrial Fibrillation"</span><span class="op">)</span></span>
<span><span class="va">stroke</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cs.html">cs</a></span><span class="op">(</span><span class="fu"><a href="../reference/cs.html">descendants</a></span><span class="op">(</span><span class="fl">4310996</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Ischemic Stroke"</span><span class="op">)</span></span>
<span><span class="va">hyp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cs.html">cs</a></span><span class="op">(</span><span class="fu"><a href="../reference/cs.html">descendants</a></span><span class="op">(</span><span class="fl">320128</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Hypertension"</span><span class="op">)</span></span>
<span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cs.html">cs</a></span><span class="op">(</span><span class="fu"><a href="../reference/cs.html">descendants</a></span><span class="op">(</span><span class="fl">4329847</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Myocardial Infarction"</span><span class="op">)</span></span>
<span><span class="va">hf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cs.html">cs</a></span><span class="op">(</span><span class="fu"><a href="../reference/cs.html">descendants</a></span><span class="op">(</span><span class="fl">316139</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Heart Failure"</span><span class="op">)</span></span></code></pre></div>
<p>Once I have my concept sets, I could build each cohort one at a time.
What is preferred is to use the R functional factories in order to not
write code for each concept set. It is recommended to use the function
factories provided in the <a href="https://purrr.tidyverse.org/" class="external-link"><code>purrr</code></a> package.
Below is an example of how we can use purrr to build multiple cohorts
from our Capr template. The <code>cvCohorts</code> object returns a list
of four Capr Cohort class objects.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">afib</span>, <span class="va">stroke</span>, <span class="va">hyp</span>, <span class="va">mi</span>, <span class="va">hf</span><span class="op">)</span></span>
<span><span class="va">cvCohorts</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">cvSet</span>, <span class="op">~</span><span class="fu">cvEvents</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="improving-the-template">Improving the Template<a class="anchor" aria-label="anchor" href="#improving-the-template"></a>
</h2>
<p>In the previous example, our <code>cvEvents</code> function returned
a Capr Cohort object. What if we wanted the output to be json and even
better save to a folder? We can improve the Capr template function to
create the json object; an example is provided below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvEvents2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">conceptSet</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#Capr template logic</span></span>
<span>  <span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    entry <span class="op">=</span> <span class="fu"><a href="../reference/entry.html">entry</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/condition.html">condition</a></span><span class="op">(</span><span class="va">conceptSet</span><span class="op">)</span>,</span>
<span>      observationWindow <span class="op">=</span> <span class="fu"><a href="../reference/continuousObservation.html">continuousObservation</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    exit <span class="op">=</span> <span class="fu"><a href="../reference/exit.html">exit</a></span><span class="op">(</span></span>
<span>      endStrategy <span class="op">=</span> <span class="fu"><a href="../reference/observationExit.html">observationExit</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#coerce cohort to json</span></span>
<span>  <span class="va">cohortJson</span> <span class="op">&lt;-</span> <span class="va">cd</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/toCirce.html">toCirce</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cohortJson</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-templates-from-concept-sets">Building templates from concept sets<a class="anchor" aria-label="anchor" href="#building-templates-from-concept-sets"></a>
</h2>
<p>Sometimes a single concept is insufficient for defining a clinical
idea and we need multiple concepts in the set. Also we may want to use a
concept set developed previously. The Capr function
<code>readConceptSet</code> allows one to import a concept set from a
.csv or .json file that we can use towards the cohort template. We
update our Capr template function to handle the import of a concept set,
as shown below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvEvents3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># get file name</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#retreive concept set</span></span>
<span>  <span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu">Capr</span><span class="fu">::</span><span class="fu"><a href="../reference/readConceptSet.html">readConceptSet</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">file</span>, name <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Capr template logic</span></span>
<span>  <span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    entry <span class="op">=</span> <span class="fu"><a href="../reference/entry.html">entry</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/condition.html">condition</a></span><span class="op">(</span><span class="va">conceptSet</span><span class="op">)</span>,</span>
<span>      observationWindow <span class="op">=</span> <span class="fu"><a href="../reference/continuousObservation.html">continuousObservation</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    exit <span class="op">=</span> <span class="fu"><a href="../reference/exit.html">exit</a></span><span class="op">(</span></span>
<span>      endStrategy <span class="op">=</span> <span class="fu"><a href="../reference/observationExit.html">observationExit</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#coerce cohort to json</span></span>
<span>  <span class="va">cohortJson</span> <span class="op">&lt;-</span> <span class="va">cd</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/toCirce.html">toCirce</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cohortJson</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s use the example of acute myocardial infarction. For the cohort,
we want to use a concept set that includes MI but excludes old MI.
Luckily, we have a concept set from ATLAS that we used in a previous
study that has this already detailed. We can import the csv file for
this concept set and apply it to the Capr template.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">miPath</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html" class="external-link">path_package</a></span><span class="op">(</span><span class="st">"Capr"</span>, <span class="st">"extdata/acuteMI.csv"</span><span class="op">)</span> </span>
<span><span class="va">miCohort</span> <span class="op">&lt;-</span> <span class="fu">cvEvents3</span><span class="op">(</span><span class="va">miPath</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">miCohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "ConceptSets": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "id": 0,</span></span>
<span><span class="co">#&gt;       "name": "Inpatient or ER visit",</span></span>
<span><span class="co">#&gt;       "expression": {</span></span>
<span><span class="co">#&gt;         "items": [</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "concept": {</span></span>
<span><span class="co">#&gt;               "CONCEPT_ID": 262,</span></span>
<span><span class="co">#&gt;               "CONCEPT_NAME": "Emergency Room and Inpatient Visit",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT": "S",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CODE": "ERIP",</span></span>
<span><span class="co">#&gt;               "DOMAIN_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "VOCABULARY_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CLASS_ID": ""</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "isExcluded": false,</span></span>
<span><span class="co">#&gt;             "includeDescendants": true,</span></span>
<span><span class="co">#&gt;             "includeMapped": false</span></span>
<span><span class="co">#&gt;           },</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "concept": {</span></span>
<span><span class="co">#&gt;               "CONCEPT_ID": 9203,</span></span>
<span><span class="co">#&gt;               "CONCEPT_NAME": "Emergency Room Visit",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT": "S",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CODE": "ER",</span></span>
<span><span class="co">#&gt;               "DOMAIN_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "VOCABULARY_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CLASS_ID": ""</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "isExcluded": false,</span></span>
<span><span class="co">#&gt;             "includeDescendants": true,</span></span>
<span><span class="co">#&gt;             "includeMapped": false</span></span>
<span><span class="co">#&gt;           },</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "concept": {</span></span>
<span><span class="co">#&gt;               "CONCEPT_ID": 9201,</span></span>
<span><span class="co">#&gt;               "CONCEPT_NAME": "Inpatient Visit",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT": "S",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CODE": "IP",</span></span>
<span><span class="co">#&gt;               "DOMAIN_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "VOCABULARY_ID": "Visit",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CLASS_ID": ""</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "isExcluded": false,</span></span>
<span><span class="co">#&gt;             "includeDescendants": true,</span></span>
<span><span class="co">#&gt;             "includeMapped": false</span></span>
<span><span class="co">#&gt;           },</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "concept": {</span></span>
<span><span class="co">#&gt;               "CONCEPT_ID": 4329847,</span></span>
<span><span class="co">#&gt;               "CONCEPT_NAME": "Myocardial infarction",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT": "S",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CODE": "22298006",</span></span>
<span><span class="co">#&gt;               "DOMAIN_ID": "Condition",</span></span>
<span><span class="co">#&gt;               "VOCABULARY_ID": "SNOMED",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CLASS_ID": ""</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "isExcluded": false,</span></span>
<span><span class="co">#&gt;             "includeDescendants": true,</span></span>
<span><span class="co">#&gt;             "includeMapped": false</span></span>
<span><span class="co">#&gt;           },</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "concept": {</span></span>
<span><span class="co">#&gt;               "CONCEPT_ID": 314666,</span></span>
<span><span class="co">#&gt;               "CONCEPT_NAME": "Old myocardial infarction",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT": "S",</span></span>
<span><span class="co">#&gt;               "STANDARD_CONCEPT_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON": "",</span></span>
<span><span class="co">#&gt;               "INVALID_REASON_CAPTION": "",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CODE": "1755008",</span></span>
<span><span class="co">#&gt;               "DOMAIN_ID": "Condition",</span></span>
<span><span class="co">#&gt;               "VOCABULARY_ID": "SNOMED",</span></span>
<span><span class="co">#&gt;               "CONCEPT_CLASS_ID": ""</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "isExcluded": true,</span></span>
<span><span class="co">#&gt;             "includeDescendants": true,</span></span>
<span><span class="co">#&gt;             "includeMapped": false</span></span>
<span><span class="co">#&gt;           }</span></span>
<span><span class="co">#&gt;         ]</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "PrimaryCriteria": {</span></span>
<span><span class="co">#&gt;     "CriteriaList": [</span></span>
<span><span class="co">#&gt;       {</span></span>
<span><span class="co">#&gt;         "ConditionOccurrence": {</span></span>
<span><span class="co">#&gt;           "CodesetId": 0</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;     ],</span></span>
<span><span class="co">#&gt;     "ObservationWindow": {</span></span>
<span><span class="co">#&gt;       "PriorDays": 365,</span></span>
<span><span class="co">#&gt;       "PostDays": 0</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     "PrimaryCriteriaLimit": {</span></span>
<span><span class="co">#&gt;       "Type": "First"</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "QualifiedLimit": {</span></span>
<span><span class="co">#&gt;     "Type": "First"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "ExpressionLimit": {</span></span>
<span><span class="co">#&gt;     "Type": "First"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "InclusionRules": [],</span></span>
<span><span class="co">#&gt;   "CensoringCriteria": [],</span></span>
<span><span class="co">#&gt;   "CollapseSettings": {</span></span>
<span><span class="co">#&gt;     "CollapseType": "ERA",</span></span>
<span><span class="co">#&gt;     "EraPad": 0</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "CensorWindow": {},</span></span>
<span><span class="co">#&gt;   "cdmVersionRange": "&gt;=5.0.0"</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="saving-capr-cohorts">Saving Capr cohorts<a class="anchor" aria-label="anchor" href="#saving-capr-cohorts"></a>
</h2>
<p>Once you have built the cohorts you need for your study using Capr,
you want to save them to a directory to use them in the study. Taking
the <code>miCohort</code> as an example, we can save the json output to
file using <code><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">readr::write_file</a></code> or the base R equivalent.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">outputPath</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"cohorts"</span><span class="op">)</span>, <span class="st">"miCohort"</span>, ext <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">write_file</a></span><span class="op">(</span><span class="va">miCohort</span>, file <span class="op">=</span> <span class="va">outputPath</span><span class="op">)</span></span></code></pre></div>
<p>To save multiple cohorts from a list we can functionalize the
<code><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">readr::write_file</a></code> using <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::walk</a></code>.</p>
</div>
<div class="section level2">
<h2 id="final-thoughts">Final thoughts<a class="anchor" aria-label="anchor" href="#final-thoughts"></a>
</h2>
<p>Cohort templating is a very powerful application of Capr. Instead of
defining the cohort logic for multiple inputs, we can create a template
to iterate across inputs. Your template can be as simple or as complex
as you wish. By following the Capr syntax, a user can build cohorts how
they please and iterate! The templates become more manageable when using
function factories in R offered by the <code>purrr</code> package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Lavallee, Adam Black.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
